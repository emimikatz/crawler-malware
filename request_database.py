import urllib.request
import gridfs
import os
import hashlib
import ssdeep
import pefile
import json
import requests
import mimetypes
from init_database import *
from init_connection import *
from virustotal_python import Virustotal

fpath = 'report/'
dir_path = os.path.dirname(os.path.realpath(__file__))

def get_hash_malware(db, type_hash, hash_value):
    print("\n********************")
    print("****PRINT IP DB****") 
    print("********************")

    collection = db['ip_collection']
    cursor = collection.find({ "address_ip": ip_value })
    print("\n*** MALWARE_COLLECTION ***") 
    for document in cursor:
        for x in document:
            print(x + ':', document[x])
        print("\n")
    print("\n")
    print("********************")
    print("**END PRINT HASH DB**")
    print("********************")

def get_ip_malware(db, ip):
    print("\n********************")
    print("****PRINT IP DB****") 
    print("********************")
    
    if type_hash == "md5" or type_hash == "sha256" or type_hash == "sha1" or type_hash == "ssdeep" or type_hash == "imphash":
        column_name = type_hash + "_malware"

        collection = db['malware_collection']
        cursor = collection.find({ column_name: hash_value })
        print("\n*** MALWARE_COLLECTION ***") 
        for document in cursor:
            for x in document:
                print(x + ':', document[x])
            print("\n")
        print("\n")
    else:
        print("Bad type for hash : " + type_hash)
    print("********************")
    print("**END PRINT IP DB**")
    print("********************")

