import urllib.request
import os
import hashlib
import ssdeep
import pefile

dir_path = os.path.dirname(os.path.realpath(__file__))

def get_md5(fname):
    hash_md5 = hashlib.md5()
    with open(fname, 'rb') as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
        return hash_md5.hexdigest()

def get_sha256(fname):
    hash_sha256 = hashlib.sha256()
    with open(fname, 'rb') as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha256.update(chunk)
        return hash_sha256.hexdigest()

def get_sha1(fname):
    hash_sha1 = hashlib.sha1()
    with open(fname, 'rb') as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha1.update(chunk)
        return hash_sha1.hexdigest()

def get_ssdeep(fname):
    hash_ssdeep = ssdeep.Hash()
    with open(fname, 'rb') as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_ssdeep.update(chunk)
        return hash_ssdeep.digest()

def is_exe(fname):
    if fname[-1] == 'e':
        if fname[-2] == 'x':
            if fname[-3] == 'e':
                if fname[-4] == '.':
                    return True
                return False

def get_imphash(fname):
    if is_exe(fname):
        imps = []
        p = pefile.PE(fname)
        imphash = p.get_imphash()
        imps.append(imphash)
        return imps


def main():
    url = 'https://www.alkanzalzahabi.com/yas33.exe'
    print(dir_path)
    urllib.request.urlretrieve(url, dir_path + '/malwares/yas33.exe')
    print(get_md5(dir_path + '/malwares/yas33.exe'))
    print(get_sha256(dir_path + '/malwares/yas33.exe'))
    print(get_sha1(dir_path + '/malwares/yas33.exe'))
    print(get_ssdeep(dir_path + '/malwares/yas33.exe'))
    if is_exe(dir_path + '/malwares/yas33.exe'):
        print(get_imphash(dir_path + '/malwares/yas33.exe'))
    else:
        print("proute")

if __name__ == "__main__":
    main()

