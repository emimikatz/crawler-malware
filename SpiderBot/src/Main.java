//import java.util.ArrayList;
import java.io.*;

public class Main {
	
	/* *** Global variables : arguments of the program *** */
	public static boolean debug = false; 						/* True if debug mode is enabled, False otherwise */
	public static String sources_file;							/* Source's file name (.xml extension) 			  */ 
	public static String words_file;							/* Word's file name (.xml extension)			  */
	public static String output_file = "../data/output.xml";	/* Output file name (.xml extension) 			  */

	
	public static void main(String[] args) throws IOException {
		
		long start = System.currentTimeMillis();
		
		
		
		/* *** PARSING ARGUMENTS *** */
		Parser.parse_args(args);
		/* *** ****************  *** */
		
		
		
		/* *** INITIALIZING VARIABLES *** */
		if ( debug ) System.out.println("-Initializing variables...");
		Spider spider = new Spider(); 											/*calling constructor that initialize all the attributes of spider*/
		if ( debug ) spider.print_spider();										/*print all the attributes of spider*/
		/* *** ********************** ***  */
		
		
		
		/* *** TEST INTERNET CONNECTION *** */
		if ( debug ) System.out.println("-Check internet connection...");
		if ( SuissArmyKnife.test_internet() ) 									/*test connection succed*/
		{
			spider.setWithInternet(true);
			if ( debug ) System.out.println("\twithInternet: " + spider.isWithInternet());
		}
		else
		{
			if ( debug ) System.out.println("\twithInternet: " + spider.isWithInternet());
			System.exit(-1); 													/*no internet connection*/
		}
		/* *** ************************ *** */
		
		
		
		/* *** LOADING SOURCES *** */
		if ( debug ) System.out.println("-Loading sources...");
		if ( ! SuissArmyKnife.file_exists(sources_file) )							/*exit if the sources file does not exist*/ 
		{
			if ( debug ) System.out.println("\tError: can't load this file : " + sources_file);
			System.exit(-1);
		}	
		spider.setSources(Parser.parse_sources(sources_file)); 						/*parse sources*/
		spider.setWithSources(spider.checkSourcesChoosen(spider.getSources())); 	/*check if the user choose at least one source, exit otherwise*/
		if ( debug ) System.out.println("\twithSources: " + spider.isWithSources());
		/* *** *************** *** */
		
		
		
		/* *** LOADING WORDS *** */
		if ( debug ) System.out.println("-Loading words...");
		if ( ! SuissArmyKnife.file_exists(words_file) )							/*exit if the sources file does not exist*/
		{
			if ( debug ) System.out.println("\tError: can't load this file : " + words_file);
			System.exit(-1);
		}
		spider.setWords(Parser.parse_words(words_file)); 						/*parse words*/
		spider.setWithWords(spider.checkWordsUsed(spider.getWords())); 			/*check if there is at least one word used*/
		if ( debug ) System.out.println("\twithWords: " + spider.isWithWords());
		/* *** ************* *** */
		
		
		
		/* *** LOADING ARTICLES *** */
		if ( debug ) System.out.println("-Loading articles...");
		//if (!spider.isWithInternet() || !spider.isWithSources()) System.exit(-1); /*exit if there is no internet connection or no sources to parse*/
		// why ?????????? UP 
		//spider.setArticles(Parser.parse_articles(spider.getSources()));
		Parser.parse_articles(spider.getSources());
		/* *** **************** *** */
		
		
	
		/* *** SAVING ARTICLES *** */
		
		/* *** *************** *** */
		

		
		
		
		long end = System.currentTimeMillis();
		long time = end - start;
		System.out.println("Time: " + ((double)(time)/1000.0) + " sec");

	    
	}



}
